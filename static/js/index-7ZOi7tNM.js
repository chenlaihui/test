import{_ as J,y as l,z as d,f as r,G as v,A as e,ad as i,S as M,N as g,I as Q,U as W,V as X,K as se,R as ae,x as O,r as u,o as ne,w as ce,H as le,F as b,ae as A,E as H,d as ie,af as de}from"./index-CDHd4m-7.js";import{E as re}from"./index-Bb7nynEf.js";import{T as Y}from"./index-D3_krIJX.js";import{N as ue}from"./index-BgsyOcko.js";import{_ as j}from"./paperPlane-wi0kQdUE.js";import{a as _e}from"./product-DTCdCccy.js";import{C as me}from"./index-BUY7RLdX.js";import{C as pe}from"./index-CViZOMyQ.js";import{P as ve}from"./index-C4YtUO6x.js";import{_ as he}from"./index-1VR3Jiot.js";import{_ as fe,b as ge}from"./index-BEVg9lj_.js";import"./use-id-D2bIr3ea.js";import"./use-placeholder-BMzKlav9.js";/* empty css              */import"./index-DBGdIKog.js";import"./index-CKBujJ5N.js";const T=n=>(W("data-v-a4e08e8a"),n=n(),X(),n),ye={class:"product-header-card"},Ce={class:"product-title-box"},ke={class:"product-title"},$e={class:"product-tags"},be={key:0,class:"tag tag-highlight"},we={key:0,class:"product-department"},Ve=T(()=>e("div",{class:"divider"},null,-1)),xe={class:"manager-row"},Se=T(()=>e("div",{class:"manager-label"},"产品经理:",-1)),Ie={class:"manager-name"},Te={class:"contact-actions"},Pe=T(()=>e("img",{src:j,alt:"contact",class:"contact-icon"},null,-1)),qe=T(()=>e("span",null,"联系",-1)),De={__name:"index",props:{product:{type:Object,required:!0}},emits:["contact"],setup(n){return(_,w)=>{var p;const q=pe,V=Q,y=me,C=Y;return l(),d("div",ye,[r(y,{class:"product-info"},{default:v(()=>[r(q,null,{icon:v(()=>[e("div",{class:M(["product-logo",n.product.iconClass||"c1"])},i(n.product.icon||(n.product.name||"").slice(0,3)),3)]),title:v(()=>[e("div",Ce,[e("div",ke,i(n.product.fullName||n.product.name),1),e("div",$e,[n.product.category?(l(),d("span",be,i(n.product.category),1)):g("",!0)])])]),_:1}),n.product.department?(l(),d("div",we,[r(V,{name:"cluster-o",class:"dept-icon"}),e("span",null,"负责部门: "+i(n.product.department),1)])):g("",!0)]),_:1}),Ve,e("div",xe,[Se,e("div",Ie,i((p=n.product.manager)==null?void 0:p.name),1),e("div",Te,[r(C,{class:"contact-btn",onClick:w[0]||(w[0]=h=>_.$emit("contact",n.product.manager))},{default:v(()=>[Pe,qe]),_:1})])])])}}},Ne=J(De,[["__scopeId","data-v-a4e08e8a"]]),P=n=>(W("data-v-b24497ac"),n=n(),X(),n),Be={class:"product-detail-page"},Ee={class:"search-pill"},ze={class:"main-scroll",id:"mainScrollView"},Ue={class:"tabs-wrap"},Re={class:"customers-container"},Ge=["id"],Oe={class:"section-header"},Ae={class:"section-title-box"},He={class:"section-title"},Me={class:"section-tags"},je={class:"tag tag-blue"},Fe={key:0,class:"tag tag-grey"},Ke=["onClick"],Le={class:"contact-grid"},Je={class:"contact-col"},Qe=P(()=>e("div",{class:"col-header"},"客户方",-1)),We={class:"contact-list"},Xe={key:0,class:"list-sub-header"},Ye={key:1,class:"contact-item"},Ze={class:"person-row"},et=["onClick"],tt={class:"person-info"},ot={class:"person-name"},st={class:"person-title"},at=P(()=>e("img",{src:j,alt:"contact"},null,-1)),nt={class:"contact-col"},ct=P(()=>e("div",{class:"col-header"},"我方",-1)),lt={class:"contact-list"},it={key:0,class:"list-sub-header"},dt={key:1,class:"contact-item"},rt={class:"person-row"},ut=["onClick"],_t={class:"person-info"},mt={class:"person-name"},pt={class:"person-title"},vt=P(()=>e("img",{src:j,alt:"contact"},null,-1)),ht=ie({name:"ProductDetail"}),ft=Object.assign(ht,{setup(n){const _=se(),w=ae(),q=O(()=>_.query.keyword||_.query.name||""),V=u({}),y=u([]),C=u({}),p=u(""),h=u(!1),D=u(!1),x=u({name:"",phone:"",email:""}),N=u(!1),F=u({}),B=u(!1),E=u([]),Z=O(()=>y.value.map(t=>({group:t.entity||t.group,items:(t.items||[]).map(c=>({id:c.id||c.code,code:c.code,name:c.name||c.shortName,label:c.code}))}))),z=O(()=>y.value.flatMap(s=>s.items||[])),K=async()=>{try{const s=_.query.id||_.params.id,t=_.query.name;if(!s&&!t){console.error("缺少产品ID或名称参数");return}const c=await _e(s||t);if(c){V.value=c.product||c||{},y.value=c.customerGroups||c.customers||[],C.value=c.customerContacts||c.contacts||{};const m=z.value[0];m&&(p.value=m.id||m.code)}}catch(s){console.error("加载产品详情失败:",s)}},ee=s=>{const t=(s==null?void 0:s.id)||s;p.value=t;const c=h.value;h.value&&(h.value=!1),setTimeout(()=>{const m=document.getElementById(`customer-section-${t}`),$=document.getElementById("mainScrollView"),f=document.querySelector(".tabs-wrap");if(!m||!$)return;const o=f?f.offsetHeight:0,I=m.offsetTop-o-50;$.scrollTo({top:Math.max(0,I),behavior:"smooth"})},c?150:50)},k=s=>{x.value={name:s.name||"",phone:s.phone||"",email:s.email||""},D.value=!0},L=s=>{F.value=s,N.value=!0},te=({person:s})=>{k(s)},oe=s=>{const t=C.value[s.id||s.code];t!=null&&t.related?E.value=t.related:E.value=[{title:s.name||s.code,items:[...(t==null?void 0:t.client)||[],...(t==null?void 0:t.internal)||[]]}],B.value=!0},S=s=>C.value[s]||{client:[],internal:[]};return ne(()=>{K()}),ce(()=>[_.query.id,_.params.id,_.query.name],()=>{K()}),(s,t)=>{const c=Q,m=ue,$=Y,f=re;return l(),d("div",Be,[r(m,{"left-arrow":"",fixed:"",onClickLeft:t[0]||(t[0]=o=>le(w).back())},{title:v(()=>[e("div",Ee,[r(c,{name:"search",size:"14",class:"pill-icon"}),e("span",null,"搜索: "+i(q.value),1)])]),_:1}),e("div",ze,[r(Ne,{product:V.value,onContact:k},null,8,["product"]),e("div",Ue,[r(ve,{modelValue:p.value,"onUpdate:modelValue":t[1]||(t[1]=o=>p.value=o),data:Z.value,expanded:h.value,"list-title":"全部客户","onUpdate:expanded":t[2]||(t[2]=o=>h.value=o),onTabChange:ee},null,8,["modelValue","data","expanded"])]),e("div",Re,[(l(!0),d(b,null,A(z.value,o=>{var U,I;return l(),d("div",{key:o.id||o.code,id:`customer-section-${o.id||o.code}`,class:"customer-section"},[e("div",Oe,[e("div",Ae,[e("div",He,i(o.code||o.name),1),e("div",Me,[e("span",je,i(o.entity),1),o.industry?(l(),d("span",Fe,i(o.industry),1)):g("",!0)])]),e("a",{class:"section-link",onClick:a=>oe(o)}," 关联方 → ",8,Ke)]),e("div",Le,[e("div",Je,[Qe,e("div",We,[(l(!0),d(b,null,A(S(o.id||o.code).client,(a,R)=>(l(),d(b,{key:`client-${R}`},[a.type==="group"?(l(),d("div",Xe,i(a.label),1)):(l(),d("div",Ye,[e("div",Ze,[e("div",{class:M(["avatar",a.theme||""]),style:de(a.style),onClick:G=>L(a)},i(a.initial||(a.name||"").charAt(0)),15,et),e("div",tt,[e("div",ot,i(a.name),1),e("div",st,i(a.title||a.role),1)]),r($,{class:"contact-trigger icon-only",onClick:G=>k(a)},{default:v(()=>[at]),_:2},1032,["onClick"])])]))],64))),128)),(U=S(o.id||o.code).client)!=null&&U.filter(a=>a.name).length?g("",!0):(l(),H(f,{key:0,description:"暂无客户联系人","image-size":40}))])]),e("div",nt,[ct,e("div",lt,[(l(!0),d(b,null,A(S(o.id||o.code).internal,(a,R)=>(l(),d(b,{key:`internal-${R}`},[a.type==="group"?(l(),d("div",it,i(a.label),1)):(l(),d("div",dt,[e("div",rt,[e("div",{class:M(["avatar",a.theme||""]),onClick:G=>L(a)},i(a.initial||(a.name||"").charAt(0)),11,ut),e("div",_t,[e("div",mt,i(a.name),1),e("div",pt,i(a.title||a.role),1)]),r($,{class:"contact-trigger icon-only",onClick:G=>k(a)},{default:v(()=>[vt]),_:2},1032,["onClick"])])]))],64))),128)),(I=S(o.id||o.code).internal)!=null&&I.filter(a=>a.name).length?g("",!0):(l(),H(f,{key:0,description:"暂无内部联系人","image-size":40}))])])])],8,Ge)}),128)),z.value.length?g("",!0):(l(),H(f,{key:0,description:"暂无客户数据"}))])]),r(he,{modelValue:D.value,"onUpdate:modelValue":t[3]||(t[3]=o=>D.value=o),name:x.value.name,phone:x.value.phone,email:x.value.email},null,8,["modelValue","name","phone","email"]),r(fe,{modelValue:N.value,"onUpdate:modelValue":t[4]||(t[4]=o=>N.value=o),person:F.value,onContactClick:te},null,8,["modelValue","person"]),r(ge,{modelValue:B.value,"onUpdate:modelValue":t[5]||(t[5]=o=>B.value=o),data:E.value,onContactClick:t[6]||(t[6]=({person:o})=>k(o))},null,8,["modelValue","data"])])}}}),Bt=J(ft,[["__scopeId","data-v-b24497ac"]]);export{Bt as default};
