import{_ as I,u as W,r as _,o as g,c as v,a as e,F as M,b as B,n as j,d as K,w as k,t as S,e as V,f as P,g as $,h as G,p as H,i as q,j as T}from"./index-D20zfMTO.js";const z={FUNASR:"funasr",VOSK:"vosk"},J="funasr",F={apiUrl:"http://10.191.6.39:8071/v1/audio/transcriptions",timeout:3e4,model:"FunASR"},A={wsUrl:"ws://10.191.40.93:2700",timeout:3e4,sampleRate:16e3};async function Q(r){const l=new(window.AudioContext||window.webkitAudioContext);try{const a=await r.arrayBuffer(),t=await l.decodeAudioData(a),o=new OfflineAudioContext(1,t.duration*A.sampleRate,A.sampleRate),n=o.createBufferSource();n.buffer=t,n.connect(o.destination),n.start();const i=await o.startRendering(),d=X(i);return new Blob([d],{type:"audio/wav"})}finally{await l.close()}}function X(r){const a=r.sampleRate,t=1,o=16,n=o/8,i=1*n,d=r.getChannelData(0),f=d.length*n,c=44+f,x=new ArrayBuffer(c),u=new DataView(x),y=(C,b)=>{for(let R=0;R<b.length;R++)u.setUint8(C+R,b.charCodeAt(R))};y(0,"RIFF"),u.setUint32(4,36+f,!0),y(8,"WAVE"),y(12,"fmt "),u.setUint32(16,16,!0),u.setUint16(20,t,!0),u.setUint16(22,1,!0),u.setUint32(24,a,!0),u.setUint32(28,a*i,!0),u.setUint16(32,i,!0),u.setUint16(34,o,!0),y(36,"data"),u.setUint32(40,f,!0);let w=44;for(let C=0;C<d.length;C++,w+=2){const b=Math.max(-1,Math.min(1,d[C]));u.setInt16(w,b<0?b*32768:b*32767,!0)}return x}async function E(r){try{console.log("开始 FunASR 语音识别，音频大小:",(r.size/1024).toFixed(2),"KB");const l=new FormData;l.append("model",F.model),l.append("file",r,"audio.wav");const a=await fetch(F.apiUrl,{method:"POST",headers:{accept:"application/json"},body:l,signal:AbortSignal.timeout(F.timeout)});if(!a.ok){const n=await a.text();throw new Error(`HTTP error! status: ${a.status}, message: ${n}`)}const t=await a.json();console.log("FunASR 识别结果:",t);let o="";return t.text?o=t.text:t.data&&t.data.text?o=t.data.text:typeof t=="string"?o=t:(console.warn("未找到识别文本，完整响应:",t),o=""),console.log("✓ 最终识别文本:",o),o}catch(l){throw console.error("FunASR 语音识别失败:",l),l}}async function Y(r){return new Promise(async(l,a)=>{let t=null,o=null;try{console.log("开始语音识别，音频大小:",(r.size/1024).toFixed(2),"KB");const n=await Q(r);console.log("音频转换完成，WAV 大小:",(n.size/1024).toFixed(2),"KB"),t=new WebSocket(A.wsUrl);let i="",d="";o=setTimeout(()=>{t&&t.readyState!==WebSocket.CLOSED&&(console.warn("识别超时，使用当前结果:",i||d),t.close(),l(i||d||""))},A.timeout),t.binaryType="arraybuffer",t.onopen=async()=>{console.log("✓ 已连接到 Vosk 服务");try{t.send(JSON.stringify({config:{sample_rate:A.sampleRate}})),console.log("已发送配置信息");const c=(await n.arrayBuffer()).slice(44);console.log("准备发送音频数据，大小:",(c.byteLength/1024).toFixed(2),"KB");const x=8192;let u=0;for(;u<c.byteLength;){const y=c.slice(u,Math.min(u+x,c.byteLength));t.send(y),u+=x,await new Promise(w=>setTimeout(w,10))}console.log("音频数据发送完成"),t.send(JSON.stringify({eof:1})),console.log("已发送结束信号")}catch(f){console.error("发送音频数据失败:",f),clearTimeout(o),a(f)}},t.onmessage=f=>{try{const c=JSON.parse(f.data);console.log("收到识别结果:",c),c.partial&&(d=c.partial,console.log("部分结果:",d)),c.text&&(i=c.text,console.log("✓ 最终识别文本:",i)),c.result&&Array.isArray(c.result)&&(i=c.result.map(x=>x.word).join(""),console.log("✓ 最终识别文本 (result):",i))}catch(c){console.error("解析结果失败:",c,f.data)}},t.onclose=()=>{console.log("WebSocket 连接已关闭"),clearTimeout(o);const f=i||d||"";console.log("最终返回结果:",f),l(f)},t.onerror=f=>{console.error("WebSocket 错误:",f),clearTimeout(o),a(new Error("Vosk 服务连接失败，请确保服务正在运行: docker ps | grep kaldi-cn"))}}catch(n){o&&clearTimeout(o),t&&t.readyState!==WebSocket.CLOSED&&t.close(),console.error("语音识别失败:",n),a(n)}})}async function Z(r,l=J){switch(l){case z.FUNASR:return console.log("使用 FunASR 语音识别服务"),E(r);case z.VOSK:return console.log("使用 Vosk 语音识别服务"),Y(r);default:return console.warn(`未知的识别引擎: ${l}，使用默认引擎 FunASR`),E(r)}}const m=r=>(H("data-v-0fa3d713"),r=r(),q(),r),ee={class:"min-h-screen flex flex-col bg-gradient-to-b from-gray-50 to-blue-100"},te={key:0,class:"fixed inset-0 z-[9999] flex flex-col bg-gradient-to-b from-blue-100 to-white"},oe=m(()=>e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",class:"w-6 h-6 text-gray-600"},[e("path",{d:"M18 6L6 18M6 6l12 12","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)),se=[oe],ne={class:"flex-1 flex flex-col justify-center items-center px-6 py-10"},ae={key:0,class:"text-base text-gray-500 mb-6"},re={key:1,class:"text-base text-gray-500 mb-6"},le=m(()=>e("div",{class:"text-xl text-gray-900 font-semibold my-3 tracking-wide"}," 找一下雅马哈信息 ",-1)),ie=m(()=>e("div",{class:"text-xl text-gray-900 font-semibold my-3 tracking-wide"}," 搜一下设备保全 ",-1)),ce=m(()=>e("div",{class:"text-xl text-gray-900 font-semibold my-3 tracking-wide"}," 找下杭州雅马哈设备保全 ",-1)),de={class:"h-[33vh] bg-gradient-to-b from-blue-400 to-blue-600 flex flex-col items-center justify-center relative shadow-2xl",style:{"border-radius":"50% 50% 0 0 / 80px 80px 0 0"}},ue=m(()=>e("svg",{viewBox:"0 0 24 24",fill:"white",class:"w-9 h-9 drop-shadow-md"},[e("path",{d:"M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"}),e("path",{d:"M19 10v2a7 7 0 0 1-14 0v-2M12 19v4M8 23h8",stroke:"white",fill:"none","stroke-width":"2","stroke-linecap":"round"})],-1)),fe=[ue],he={class:"mt-5 text-base text-white/90 tracking-wider"},pe={key:0,class:"mt-2 text-sm text-white/70 tracking-wide"},ge={class:"flex flex-col justify-center min-h-[38vh] pt-10 px-6 pb-5 mt-[10vh]"},ve=m(()=>e("div",{class:"text-center mb-12"},[e("div",{class:"text-2xl font-light text-gray-800 tracking-[2px] mb-2"}," Service Customer Connect "),e("div",{class:"text-lg text-gray-600 font-normal tracking-wider"}," 服务客户·连接价值 ")],-1)),me={class:"relative max-w-[600px] w-full mx-auto"},xe={class:"relative w-full"},ye=m(()=>e("svg",{viewBox:"0 0 24 24",fill:"white",class:"w-5 h-5"},[e("path",{d:"M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"}),e("path",{d:"M19 10v2a7 7 0 0 1-14 0v-2M12 19v4M8 23h8",stroke:"white",fill:"none","stroke-width":"2","stroke-linecap":"round"})],-1)),we=[ye],be={class:"px-6 py-6"},_e=m(()=>e("div",{class:"text-[15px] font-semibold text-gray-700 mb-4 pl-1"},"常用功能",-1)),ke={class:"grid grid-cols-4 gap-5"},Se=["onClick"],Ce={class:"w-14 h-14 bg-white/90 backdrop-blur-sm rounded-xl flex items-center justify-center mb-2.5 shadow-sm border border-gray-200"},Te={class:"text-[13px] text-gray-700 font-medium"},Re={class:"px-6 pb-20"},Ae={class:"flex justify-between items-center mb-4 px-1"},Me=m(()=>e("div",{class:"text-lg font-semibold text-gray-900"},"待办任务",-1)),Be=m(()=>e("span",null,"›",-1)),Fe=["onClick"],Ue={class:"flex justify-between items-start mb-3"},je={class:"flex-1"},Ve={class:"text-base font-semibold text-gray-900 mb-1.5 leading-snug"},ze={class:"text-[13px] text-gray-500"},Ee={class:"text-sm text-gray-700 leading-relaxed mb-3"},Le={class:"flex justify-between items-center pt-3 border-t border-gray-100"},Ne={class:"text-[13px] text-gray-500"},Oe=["onClick"],De={__name:"index",setup(r){const l=W(),a=_(!1),t=_(!1),o=_(null),n=_([]),i=_(null),d=_(!1),f=()=>{l.push({name:"Search"})},c=_([{label:"随手记",action:"note",icon:()=>T("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[T("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7","stroke-linecap":"round","stroke-linejoin":"round"}),T("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z","stroke-linecap":"round","stroke-linejoin":"round"})])},{label:"客户拜访",action:"visit",icon:()=>T("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[T("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2","stroke-linecap":"round","stroke-linejoin":"round"}),T("circle",{cx:"9",cy:"7",r:"4"}),T("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75","stroke-linecap":"round","stroke-linejoin":"round"})])}]),x=_([{id:"1",title:"完成华为项目需求确认",company:"华为技术有限公司",contact:"张经理",priority:"urgent",priorityLabel:"紧急",description:"需在今日下午5点前完成项目需求确认文档的审核和签字,请提前准备相关材料",deadline:"今天 17:00 截止"},{id:"2",title:"跟进腾讯云服务器采购",company:"腾讯科技",contact:"李总监",priority:"important",priorityLabel:"重要",description:"客户对上次报价有疑问,需要重新沟通服务器配置方案",deadline:"明天 14:00 截止"},{id:"3",title:"阿里巴巴季度拜访",company:"阿里巴巴集团",contact:"王副总",priority:"normal",priorityLabel:"常规",description:"季度例行客户拜访,了解最新业务进展和合作机会",deadline:"本周五 10:00"}]),u=()=>{a.value=!0,t.value=!1},y=async()=>{try{console.log("请求麦克风权限..."),i.value||(i.value=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}})),n.value=[],o.value=new MediaRecorder(i.value),console.log("MediaRecorder 已创建，mimeType:",o.value.mimeType),o.value.ondataavailable=s=>{s.data.size>0&&(n.value.push(s.data),console.log("收集音频块:",s.data.size,"bytes"))},o.value.onstop=async()=>{console.log("录音停止，开始处理..."),await b()},o.value.start(),t.value=!0,navigator.vibrate&&navigator.vibrate(50),console.log("✓ 开始录音")}catch(s){console.error("无法访问麦克风:",s),alert("无法访问麦克风，请检查权限设置"),a.value=!1}},w=()=>{t.value&&o.value&&o.value.state!=="inactive"&&(o.value.stop(),t.value=!1,d.value=!0,console.log("停止录音，开始处理..."))},C=()=>{o.value&&o.value.state==="recording"&&o.value.stop(),i.value&&(i.value.getTracks().forEach(s=>{s.stop(),console.log("麦克风轨道已停止")}),i.value=null),t.value=!1,d.value=!1,a.value=!1,n.value=[],console.log("语音输入界面已关闭")},b=async()=>{try{const s=new Blob(n.value,{type:"audio/webm"});if(console.log("====================="),console.log("录音大小:",(s.size/1024).toFixed(2),"KB"),console.log("音频类型:",s.type),console.log("音频块数量:",n.value.length),console.log("====================="),s.size<1e3)throw new Error("录音时间太短，请重新录制");console.log("开始调用语音识别...");const p=await Z(s);if(console.log("识别结果:",p),p&&p.trim())console.log("✓ 识别成功:",p),a.value=!1,d.value=!1,setTimeout(()=>{l.push({name:"Search",query:{q:p}})},100);else throw console.warn("识别结果为空"),new Error("未识别到内容，请说话声音大一些，并在安静的环境中录音")}catch(s){console.error("处理录音失败:",s),d.value=!1,a.value=!1;const p=s.message||"语音识别失败，请重试";alert(p)}finally{n.value=[]}},R=s=>{console.log("快捷操作:",s)},L=()=>{console.log("查看全部待办")},N=s=>{console.log("打开任务:",s)},O=s=>{confirm("确认完成此任务?")&&console.log("完成任务:",s.id)},D=s=>{const p={urgent:"bg-red-50 text-red-600",important:"bg-orange-50 text-orange-600",normal:"bg-blue-50 text-blue-900"};return p[s]||p.normal};return(s,p)=>(g(),v("div",ee,[a.value?(g(),v("div",te,[e("div",{class:"flex justify-end p-4"},[e("button",{class:"w-10 h-10 bg-white/80 rounded-full flex items-center justify-center shadow-lg hover:bg-white active:scale-95 transition-all",onClick:C},se)]),e("div",ne,[d.value?(g(),v("div",ae,"正在识别中...")):(g(),v("div",re,"你可以这样说")),d.value?B("",!0):(g(),v(M,{key:2},[le,ie,ce],64))]),e("div",de,[e("div",{class:j(["w-20 h-20 bg-white/20 rounded-full flex items-center justify-center shadow-lg cursor-pointer hover:bg-white/30 transition-all",{"scale-110":t.value}]),style:K(t.value?"animation: pulse 2s ease-in-out infinite":""),onTouchstart:k(y,["prevent"]),onTouchend:k(w,["prevent"]),onTouchcancel:k(w,["prevent"]),onMousedown:k(y,["prevent"]),onMouseup:k(w,["prevent"]),onMouseleave:w},fe,38),e("div",he,S(t.value?"正在聆听...":"按住开始说话"),1),t.value?(g(),v("div",pe," 松开结束录音 ")):B("",!0)])])):B("",!0),e("div",ge,[ve,e("div",me,[e("div",xe,[e("input",{type:"text",class:"w-full bg-white/95 backdrop-blur-sm rounded-lg border border-gray-300 py-3.5 pr-14 pl-5 text-[15px] text-gray-900 outline-none transition-all shadow-sm focus:border-blue-900 focus:bg-white focus:shadow-lg focus:ring-4 focus:ring-blue-100",placeholder:"搜客户、产品或点击麦克风说话",readonly:"",onClick:f}),e("button",{class:"absolute right-1.5 top-1/2 -translate-y-1/2 w-10 h-9 bg-gradient-to-br from-blue-900 to-blue-600 rounded-md flex items-center justify-center hover:opacity-90 active:scale-95 transition-all",onClick:k(u,["stop"])},we)])])]),e("div",be,[_e,e("div",ke,[(g(!0),v(M,null,V(c.value,h=>(g(),v("div",{key:h.name,class:"flex flex-col items-center cursor-pointer active:scale-94 transition-transform",onClick:U=>R(h.action)},[e("div",Ce,[(g(),$(G(h.icon),{class:"w-6 h-6 text-blue-900"}))]),e("span",Te,S(h.label),1)],8,Se))),128))])]),e("div",Re,[e("div",Ae,[Me,e("a",{href:"#",class:"text-sm text-gray-600 flex items-center gap-1",onClick:k(L,["prevent"])},[P(" 查看全部 "),Be])]),(g(!0),v(M,null,V(x.value,h=>(g(),v("div",{key:h.id,class:"bg-white/95 backdrop-blur-sm rounded-lg p-4 mb-3 shadow-sm border border-gray-200 active:translate-y-px active:shadow-none transition-all cursor-pointer",onClick:U=>N(h)},[e("div",Ue,[e("div",je,[e("div",Ve,S(h.title),1),e("div",ze,S(h.company)+" · "+S(h.contact),1)]),e("span",{class:j(["px-2.5 py-1 rounded-full text-xs font-medium flex-shrink-0",D(h.priority)])},S(h.priorityLabel),3)]),e("div",Ee,S(h.description),1),e("div",Le,[e("div",Ne,S(h.deadline),1),e("button",{class:"px-4 py-1.5 bg-blue-50 text-blue-900 rounded-full text-sm font-medium hover:bg-blue-900 hover:text-white active:bg-blue-900 active:text-white transition-colors",onClick:k(U=>O(h),["stop"])}," 完成 ",8,Oe)])],8,Fe))),128))])]))}},We=I(De,[["__scopeId","data-v-0fa3d713"]]);export{We as default};
