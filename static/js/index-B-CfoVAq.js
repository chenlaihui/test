import{c as _e,d as z,$ as Ee,f as m,n as $e,j as de,a6 as Ae,X as Ue,a as pe,a3 as He,Z as Se,a7 as Fe,t as fe,q as Ge,r as b,Y as qe,x as O,a8 as We,w as Xe,a9 as Ye,k as Ne,aa as Ke,p as ke,m as Ze,ab as X,ac as Y,_ as K,R as Z,o as J,y as t,z as c,A as e,a2 as q,ad as C,H as Je,F as T,ae as j,S as L,af as ve,N as M,ag as Qe,U as Te,V as Ve,E as S,G as h,I as le,ah as ae,a0 as et,O as tt}from"./index-CDHd4m-7.js";import{T as oe,a as ce,_ as st,b as at}from"./index-BEVg9lj_.js";import{g as nt,a as ge,b as je,c as lt,d as ot,e as ct,f as rt}from"./workbench-DFCj1b8v.js";import{c as Pe,C as W}from"./index-CViZOMyQ.js";import"./index-D-jpgpWR.js";import{S as it}from"./index-Biv-2Zfy.js";import{C as Me}from"./index-BUY7RLdX.js";import{G as ut,a as dt}from"./index-BrYkbpSe.js";import{E as mt}from"./index-Bb7nynEf.js";import{_ as Oe}from"./paperPlane-wi0kQdUE.js";import{T as ft}from"./index-D3_krIJX.js";import{_ as vt}from"./index-1VR3Jiot.js";/* empty css              */import"./index-DBGdIKog.js";import"./index-CKBujJ5N.js";import"./use-id-D2bIr3ea.js";const[_t,me]=_e("switch"),pt={size:$e,loading:Boolean,disabled:Boolean,modelValue:de,activeColor:String,inactiveColor:String,activeValue:{type:de,default:!0},inactiveValue:{type:de,default:!1}};var gt=z({name:_t,props:pt,emits:["change","update:modelValue"],setup(s,{emit:f,slots:a}){const v=()=>s.modelValue===s.activeValue,n=()=>{if(!s.disabled&&!s.loading){const u=v()?s.inactiveValue:s.activeValue;f("update:modelValue",u),f("change",u)}},l=()=>{if(s.loading){const u=v()?s.activeColor:s.inactiveColor;return m(Ae,{class:me("loading"),color:u},null)}if(a.node)return a.node()};return Ee(()=>s.modelValue),()=>{var u;const{size:r,loading:i,disabled:o,activeColor:p,inactiveColor:d}=s,k=v(),x={fontSize:Ue(r),backgroundColor:k?p:d};return m("div",{role:"switch",class:me({on:k,loading:i,disabled:o}),style:x,tabindex:o?void 0:0,"aria-checked":k,onClick:n},[m("div",{class:me("node")},[l()]),(u=a.background)==null?void 0:u.call(a)])}}});const bt=pe(gt),[ze,ht]=_e("collapse"),Re=Symbol(ze),xt={border:fe,accordion:Boolean,modelValue:{type:[String,Number,Array],default:""}};var yt=z({name:ze,props:xt,emits:["change","update:modelValue"],setup(s,{emit:f,slots:a}){const{linkChildren:v,children:n}=He(Re),l=o=>{f("change",o),f("update:modelValue",o)},u=(o,p)=>{const{accordion:d,modelValue:k}=s;l(d?o===k?"":o:p?k.concat(o):k.filter(x=>x!==o))},r=(o={})=>{if(s.accordion)return;typeof o=="boolean"&&(o={expanded:o});const{expanded:p,skipDisabled:d}=o,x=n.filter(y=>y.disabled&&d?y.expanded.value:p??!y.expanded.value).map(y=>y.itemName.value);l(x)},i=o=>{const{accordion:p,modelValue:d}=s;return p?d===o:d.includes(o)};return Se({toggleAll:r}),v({toggle:u,isExpanded:i}),()=>{var o;return m("div",{class:[ht(),{[Fe]:s.border}]},[(o=a.default)==null?void 0:o.call(a)])}}});const kt=pe(yt),[wt,ne]=_e("collapse-item"),Ct=["icon","title","value","label","right-icon"],$t=Ge({},Pe,{name:$e,isLink:fe,disabled:Boolean,readonly:Boolean,lazyRender:fe});var St=z({name:wt,props:$t,setup(s,{slots:f}){const a=b(),v=b(),{parent:n,index:l}=qe(Re);if(!n)return;const u=O(()=>{var V;return(V=s.name)!=null?V:l.value}),r=O(()=>n.isExpanded(u.value)),i=b(r.value),o=We(()=>i.value||!s.lazyRender),p=()=>{r.value?a.value&&(a.value.style.height=""):i.value=!1};Xe(r,(V,I)=>{if(I===null)return;V&&(i.value=!0),(V?Ne:Ke)(()=>{if(!v.value||!a.value)return;const{offsetHeight:B}=v.value;if(B){const G=`${B}px`;a.value.style.height=V?"0":G,Ye(()=>{a.value&&(a.value.style.height=V?G:"0")})}else p()})});const d=(V=!r.value)=>{n.toggle(u.value,V)},k=()=>{!s.disabled&&!s.readonly&&d()},x=()=>{const{border:V,disabled:I,readonly:U}=s,B=ke(s,Object.keys(Pe));return U&&(B.isLink=!1),(I||U)&&(B.clickable=!1),m(W,Ze({role:"button",class:ne("title",{disabled:I,expanded:r.value,borderless:!V}),"aria-expanded":String(r.value),onClick:k},B),ke(f,Ct))},y=o(()=>{var V;return X(m("div",{ref:a,class:ne("wrapper"),onTransitionend:p},[m("div",{ref:v,class:ne("content")},[(V=f.default)==null?void 0:V.call(f)])]),[[Y,i.value]])});return Se({toggle:d,expanded:r,itemName:u}),()=>m("div",{class:[ne({border:l.value&&s.border})]},[x(),y()])}});const Nt=pe(St),Tt=s=>(Te("data-v-d57f7d3d"),s=s(),Ve(),s),Vt={class:"bg-gradient-to-b from-[#e6f4ff] to-[#f0f2f5]"},jt={class:"px-5 pt-3 pb-4"},Pt=Tt(()=>e("div",{class:"flex justify-between items-center mb-3"},[e("h1",{class:"text-xl font-bold tracking-tight text-gray-900"},"控制台")],-1)),Mt={key:0,class:"space-y-2"},Ot={class:"flex justify-between items-center px-2"},zt={class:"text-base font-bold text-gray-600"},Rt={class:"ml-1 text-xs font-normal text-gray-400 bg-white/50 px-1.5 py-0.5 rounded-full"},It={class:"relative w-full"},Dt={class:"grid grid-cols-5 justify-items-center"},Bt=["onClick"],Lt=["innerHTML"],Et={key:0,class:"absolute bottom-1 left-0 right-0 flex justify-center"},At={class:"rounded-full relative overflow-hidden",style:{width:"32px",height:"6px","background-color":"#d1d5db"}},Ut=z({name:"WorkbenchHeader"}),Ht=Object.assign(Ut,{setup(s){const f=Z(),a=b({total:0,pages:[]}),v=b(0),n=b(null),l={c1:"bg-blue-100 text-blue-700",c2:"bg-green-100 text-green-700",c3:"bg-purple-100 text-purple-700",c4:"bg-orange-100 text-orange-700"},u=()=>{f.push({name:"Search"})},r=o=>{f.push({name:"CustomerProfile",query:{name:o.name}})},i=()=>{const o=n.value;if(!o)return;const p=o.scrollWidth-o.clientWidth;v.value=p>0?o.scrollLeft/p:0};return J(async()=>{try{a.value=await nt()}catch(o){console.warn("获取重点关注客户失败",o)}}),(o,p)=>{const d=it;return t(),c("header",Vt,[e("div",jt,[Pt,m(d,{placeholder:"大家都在搜 “A1-MES上了哪些据点”",readonly:!0,shape:"round",class:"workbench-search",onClickInput:u}),a.value.pages.length?(t(),c("div",Mt,[e("div",Ot,[e("h2",zt,[q(" 重点关注 "),e("span",Rt,C(a.value.total),1)]),e("button",{class:"text-xs text-blue-600 font-medium",onClick:p[0]||(p[0]=k=>Je(f).push({name:"FocusContacts"}))},"管理列表")]),e("div",It,[e("div",{ref_key:"sliderRef",ref:n,class:"flex overflow-x-auto snap-x snap-mandatory pb-4 pt-3 hide-scrollbar",style:{"scroll-behavior":"smooth"},onScroll:i},[(t(!0),c(T,null,j(a.value.pages,(k,x)=>(t(),c("div",{key:x,class:"w-full flex-shrink-0 snap-center"},[e("div",Dt,[(t(!0),c(T,null,j(k,y=>{var V,I;return t(),c("div",{key:y.id,class:"flex flex-col items-center gap-2 w-12 cursor-pointer",onClick:U=>r(y)},[e("div",{class:L(["w-12 h-12 rounded-md flex items-center justify-center shadow-sm text-sm font-semibold leading-tight text-center px-0.5",l[y.colorClass]||"bg-gray-100 text-gray-700"])},[e("span",{innerHTML:((V=y.abbr)==null?void 0:V.replace(/\\n/g,"<br>"))||((I=y.name)==null?void 0:I.slice(0,4))},null,8,Lt)],2)],8,Bt)}),128))])]))),128))],544),a.value.pages.length>1?(t(),c("div",Et,[e("div",At,[e("div",{class:"absolute left-0 bg-blue-600 rounded-full transition-transform duration-300 ease-out",style:ve([{width:"50%",height:"100%",top:"0"},{transform:`translateX(${v.value*100}%)`}])},null,4)])])):M("",!0)])])):M("",!0)]),Qe(o.$slots,"header-extra",{},void 0,!0)])}}}),re=K(Ht,[["__scopeId","data-v-d57f7d3d"]]),Ft={class:"flex items-center gap-1"},Gt={class:"text-base font-bold text-gray-800"},qt={class:"grid grid-cols-3 gap-3 px-4 pb-4 pt-3"},Wt={class:"text-xs text-gray-600 font-medium"},Xt=z({name:"MetricCard"}),be=Object.assign(Xt,{props:{title:{type:String,required:!0},showLink:{type:Boolean,default:!1},showInfo:{type:Boolean,default:!1},items:{type:Array,default:()=>[]}},emits:["link-click","info-click"],setup(s,{emit:f}){const a=f;return(v,n)=>{const l=le,u=W,r=Me;return t(),S(r,{inset:"",class:"!m-0 !rounded-xl shadow-sm"},{default:h(()=>[m(u,{border:!1,class:"!pb-0"},{title:h(()=>[e("div",Ft,[e("span",Gt,C(s.title),1),s.showInfo?(t(),S(l,{key:0,name:"info-o",class:"text-gray-400 cursor-pointer hover:text-blue-600 transition-colors",onClick:n[0]||(n[0]=i=>a("info-click"))})):M("",!0)])]),"right-icon":h(()=>[s.showLink?(t(),c("a",{key:0,class:"text-xs text-blue-600 flex items-center font-medium cursor-pointer",onClick:n[1]||(n[1]=i=>a("link-click"))},[q(" 全部 "),m(l,{name:"arrow",size:"12",class:"ml-0.5"})])):M("",!0)]),_:1}),e("div",qt,[(t(!0),c(T,null,j(s.items,(i,o)=>X((t(),c("div",{key:o,class:"bg-gray-50 p-3 rounded-lg flex flex-col justify-between"},[e("div",{class:L(["text-2xl font-sans leading-none mb-1",i.color==="red"?"text-red-500":"text-gray-800"])},C(i.value),3),e("span",Wt,C(i.label),1)])),[[Y,!i.hidden]])),128))])]),_:1})}}}),Yt={class:"flex flex-col justify-center leading-none"},Kt={class:"flex flex-col items-end justify-center flex-shrink-0 leading-none"},Zt={class:"text-gray-600 font-sans",style:{"font-size":"20px","font-weight":"400","line-height":"1"}},Jt=e("div",{class:"text-gray-500",style:{"font-size":"10px","line-height":"1.2"}},"客户数",-1),Qt=z({name:"BusinessEntityCard"}),we=Object.assign(Qt,{props:{entityName:{type:String,default:""},count:{type:[Number,String],default:0},selected:{type:Boolean,default:!1},starred:{type:Boolean,default:!1}},emits:["select"],setup(s,{emit:f}){const a=s,v=f,n=O(()=>{const u=a.entityName;return u.includes("_")?u.split("_"):u.length>2?[u.slice(0,2),u.slice(2).replace("-","")]:[u]}),l=()=>{v("select",{entityName:a.entityName})};return(u,r)=>{const i=le,o=W;return t(),S(o,{class:L(["relative rounded-lg shadow-sm border border-gray-100 cursor-pointer h-14 transition-all duration-200",[s.selected?"bg-blue-50 ring-2 ring-blue-500 ring-offset-1":"bg-gray-50"]]),border:!1,onClick:l},{icon:h(()=>[s.starred?(t(),S(i,{key:0,name:"star",class:"absolute -top-2 -right-2 bg-white rounded-full shadow-sm z-10 text-yellow-500",size:"16"})):M("",!0)]),title:h(()=>[e("div",Yt,[(t(!0),c(T,null,j(n.value,(p,d)=>(t(),c("span",{key:d,class:"text-sm font-medium text-gray-600",style:{"line-height":"1.2"}},C(p),1))),128))])]),value:h(()=>[e("div",Kt,[e("div",Zt,C(s.count),1),Jt])]),_:1},8,["class"])}}}),es={class:"flex flex-col justify-end"},ts={class:"flex flex-col items-end justify-end flex-shrink-0"},ss={class:"text-gray-600 font-sans leading-none",style:{"font-size":"24px","font-weight":"400"}},as=e("div",{class:"text-gray-500 leading-tight",style:{"font-size":"10px"}},"在用服务",-1),ns=z({name:"CustomerServiceCard"}),ls=Object.assign(ns,{props:{customerName:{type:String,default:""},statusColor:{type:String,default:"gray"},count:{type:[Number,String],default:0},selected:{type:Boolean,default:!1},href:{type:String,default:""}},emits:["select"],setup(s,{emit:f}){const a=s,v=f,n=O(()=>{const i=a.customerName;return i.length>2?[i.slice(0,2),i.slice(2).replace("-","")]:i.includes("-")?i.split("-"):[i]}),l=O(()=>a.statusColor==="gray"),u=O(()=>a.selected?"bg-blue-50 ring-2 ring-blue-500 ring-offset-1":l.value?"bg-gray-200":"bg-gray-50"),r=()=>{if(a.href){window.location.href=a.href;return}v("select",{customerName:a.customerName})};return(i,o)=>{const p=W;return t(),S(p,{class:L(["rounded-lg shadow-sm border border-gray-100 cursor-pointer h-16 transition-all duration-200",u.value]),border:!1,onClick:r},{title:h(()=>[e("div",es,[(t(!0),c(T,null,j(n.value,(d,k)=>(t(),c("span",{key:k,class:"text-sm font-medium text-gray-600",style:{"line-height":"1.5"}},C(d),1))),128))])]),value:h(()=>[e("div",ts,[e("div",ss,C(s.count),1),as])]),_:1},8,["class"])}}}),os={class:"px-5 pt-3 flex flex-col pb-20 min-h-0"},cs={class:"bg-white rounded-xl shadow-sm p-4 flex-1 flex flex-col overflow-hidden min-h-0"},rs={class:"flex justify-between items-center mb-3"},is={class:"text-base font-bold text-gray-800"},us={key:1,class:"text-xs text-gray-400"},ds={class:"flex items-center w-full gap-2 px-3 py-2 mb-3 mt-2 text-sm bg-blue-50/50 border border-blue-100 rounded-lg"},ms=["innerHTML"],fs={key:0,class:"overflow-auto"},vs={key:0,class:"grid grid-cols-3 gap-2 mb-3"},_s={class:"grid grid-cols-3 gap-3"},ps={key:1,class:"flex-1 overflow-y-auto pr-1",style:{"scroll-behavior":"smooth"}},gs=["id"],bs={class:"text-sm font-bold text-gray-700 mb-2 sticky top-0 bg-white py-1 z-10"},hs={class:"text-blue-600 font-normal"},xs={class:"grid grid-cols-3 gap-3"},ys=z({name:"CustomerPanel"}),he=Object.assign(ys,{props:{panelTitle:{type:String,default:"我的客户"},tabs:{type:Array,default:()=>[]},statsText:{type:String,default:"累计负责客户"},totalCustomers:{type:[Number,String],default:0},overviewCards:{type:Array,default:()=>[]},accordions:{type:Array,default:()=>[]},customerSections:{type:Array,default:()=>[]}},emits:["customer-click","entity-click"],setup(s,{emit:f}){var k;const a=s,v=f,n=b("all"),l=b(!0),u=b(((k=a.accordions.find(x=>x.expanded))==null?void 0:k.key)||null),r=O(()=>{const x=a.tabs.find(y=>y.key===n.value);return n.value==="all"?`${a.statsText} <span class="text-blue-600 font-bold mx-1">${a.totalCustomers}</span> 家`:`${(x==null?void 0:x.label)||""} <span class="text-blue-600 font-bold mx-1">${a.totalCustomers}</span> 家`}),i=x=>{x==="all"?l.value=!0:(l.value=!1,Ne(()=>{const y=document.getElementById(`section-${x}`);y&&y.scrollIntoView({behavior:"smooth",block:"start"})}))},o=()=>{n.value="all",l.value=!0},p=x=>{x.tab&&(n.value=x.tab,i(x.tab)),v("entity-click",x)},d=x=>{v("customer-click",x)};return(x,y)=>{const V=le,I=oe,U=ce,B=Nt,G=kt;return t(),c("section",os,[e("div",cs,[e("div",rs,[e("h2",is,C(s.panelTitle),1),n.value!=="all"?(t(),c("button",{key:0,class:"flex items-center gap-1 text-blue-600 text-xs font-medium",onClick:o},[m(V,{name:"arrow-left",size:"12"}),q(" 返回概览 ")])):(t(),c("span",us,"返回概览"))]),m(U,{active:n.value,"onUpdate:active":y[0]||(y[0]=w=>n.value=w),shrink:"",onChange:i,class:"mb-2"},{default:h(()=>[(t(!0),c(T,null,j(s.tabs,w=>(t(),S(I,{key:w.key,title:w.label,name:w.key},null,8,["title","name"]))),128))]),_:1},8,["active"]),e("div",ds,[m(V,{name:"info-o",class:"text-blue-600"}),e("span",{class:"text-gray-600",innerHTML:r.value},null,8,ms)]),l.value?(t(),c("div",fs,[s.overviewCards.length?(t(),c("div",vs,[(t(!0),c(T,null,j(s.overviewCards,w=>(t(),S(we,{key:w.entityName,"entity-name":w.entityName,count:w.count,onSelect:R=>p({tab:w.entityName||w.tab,entityName:w.entityName})},null,8,["entity-name","count","onSelect"]))),128))])):M("",!0),s.accordions.length?(t(),S(G,{key:1,modelValue:u.value,"onUpdate:modelValue":y[1]||(y[1]=w=>u.value=w),accordion:""},{default:h(()=>[(t(!0),c(T,null,j(s.accordions,w=>(t(),S(B,{key:w.key,name:w.key,title:w.title},{default:h(()=>[e("div",_s,[(t(!0),c(T,null,j(w.items,R=>(t(),S(we,{key:R.entityName,"entity-name":R.entityName,count:R.count,onSelect:ee=>p(R)},null,8,["entity-name","count","onSelect"]))),128))])]),_:2},1032,["name","title"]))),128))]),_:1},8,["modelValue"])):M("",!0)])):M("",!0),l.value?M("",!0):(t(),c("div",ps,[(t(!0),c(T,null,j(s.customerSections,w=>(t(),c("section",{key:w.title,id:`section-${w.title}`,class:"mb-4"},[e("div",bs,[q(C(w.title)+" ",1),e("span",hs,"("+C(w.count)+")",1)]),e("div",xs,[(t(!0),c(T,null,j(w.customers,R=>(t(),S(ls,{key:R.customerName,"customer-name":R.customerName,"status-color":R.statusColor,count:R.count,onSelect:ee=>d(R)},null,8,["customer-name","status-color","count","onSelect"]))),128))])],8,gs))),128))]))])])}}}),ks={class:"h-screen bg-[#f0f2f5] flex flex-col overflow-hidden"},ws={class:"px-5 pb-24 pt-3 flex flex-col gap-4"},Cs=z({name:"DeptManager"}),$s=Object.assign(Cs,{setup(s){const f=Z(),a=b("overview"),v=b({}),n=b({}),l=b(!1);J(async()=>{l.value=!0;try{const[r,i]=await Promise.all([ge({role:"manager"}),je({role:"manager"})]);v.value=r||{},n.value=i||{}}catch(r){console.warn("部门经理工作台数据加载失败",r)}finally{l.value=!1}});const u=r=>{f.push({name:"CustomerDetail",query:{name:r.customerName}})};return(r,i)=>{const o=oe,p=ce;return t(),c("div",ks,[m(re),m(p,{active:a.value,"onUpdate:active":i[0]||(i[0]=d=>a.value=d),shrink:"",class:"px-1 flex-1 flex flex-col overflow-hidden van-tabs--flex"},{default:h(()=>[m(o,{title:"综合看板",name:"overview"},{default:h(()=>[e("section",ws,[(t(!0),c(T,null,j(v.value,(d,k)=>(t(),S(be,{key:k,title:d.title,items:d.items,"show-link":d.link,"show-info":d.infoModal},null,8,["title","items","show-link","show-info"]))),128))])]),_:1}),m(o,{title:"我的客户",name:"my-customers"},{default:h(()=>[m(he,{"panel-title":"我的客户",tabs:n.value.tabs||[],"stats-text":n.value.statsText||"累计负责客户","total-customers":n.value.totalCustomers||0,accordions:n.value.accordions||[],"customer-sections":n.value.customerSections||[],onCustomerClick:u},null,8,["tabs","stats-text","total-customers","accordions","customer-sections"])]),_:1})]),_:1},8,["active"])])}}}),Ss=K($s,[["__scopeId","data-v-12120787"]]),Ns={class:"h-screen bg-[#f0f2f5] flex flex-col overflow-hidden"},Ts={class:"px-5 pb-24 pt-3 flex flex-col gap-4"},Vs=z({name:"Executive"}),js=Object.assign(Vs,{setup(s){const f=Z(),a=b("overview"),v=b({}),n=b({}),l=b(!1);J(async()=>{l.value=!0;try{const[r,i]=await Promise.all([ge({role:"executive"}),lt({})]);v.value=r||{},n.value=i||{}}catch(r){console.warn("公司高层工作台数据加载失败",r)}finally{l.value=!1}});const u=r=>{f.push({name:"CustomerDetail",query:{name:r.customerName}})};return(r,i)=>{const o=oe,p=ce;return t(),c("div",Ns,[m(re),m(p,{active:a.value,"onUpdate:active":i[0]||(i[0]=d=>a.value=d),shrink:"",class:"px-1 flex-1 flex flex-col overflow-hidden van-tabs--flex"},{default:h(()=>[m(o,{title:"综合看板",name:"overview"},{default:h(()=>[e("section",Ts,[(t(!0),c(T,null,j(v.value,(d,k)=>(t(),S(be,{key:k,title:d.title,items:d.items,"show-link":d.link,"show-info":d.infoModal},null,8,["title","items","show-link","show-info"]))),128))])]),_:1}),m(o,{title:"客户分析",name:"analysis"},{default:h(()=>[m(he,{"panel-title":"客户分析",tabs:n.value.tabs||[],"stats-text":n.value.statsText||"累计负责客户","total-customers":n.value.totalCustomers||0,accordions:n.value.accordions||[],"customer-sections":n.value.customerSections||[],onCustomerClick:u},null,8,["tabs","stats-text","total-customers","accordions","customer-sections"])]),_:1})]),_:1},8,["active"])])}}}),Ps=K(js,[["__scopeId","data-v-505d4f2d"]]),Ms={class:"h-screen bg-[#f0f2f5] flex flex-col overflow-hidden"},Os={class:"px-5 pb-24 pt-3 flex flex-col gap-4"},zs=z({name:"CustomerManager"}),Rs=Object.assign(zs,{setup(s){const f=Z(),a=b("overview"),v=b({}),n=b({}),l=b(!1);J(async()=>{l.value=!0;try{const[r,i]=await Promise.all([ge({role:"customer-manager"}),je({role:"customer-manager"})]);v.value=r||{},n.value=i||{}}catch(r){console.warn("客户经理工作台数据加载失败",r)}finally{l.value=!1}});const u=r=>{f.push({name:"CustomerDetail",query:{name:r.customerName}})};return(r,i)=>{const o=oe,p=ce;return t(),c("div",Ms,[m(re),m(p,{active:a.value,"onUpdate:active":i[0]||(i[0]=d=>a.value=d),shrink:"",class:"px-1 flex-1 flex flex-col overflow-hidden van-tabs--flex"},{default:h(()=>[m(o,{title:"综合看板",name:"overview"},{default:h(()=>[e("section",Os,[(t(!0),c(T,null,j(v.value,(d,k)=>(t(),S(be,{key:k,title:d.title,items:d.items,"show-link":d.link,"show-info":d.infoModal},null,8,["title","items","show-link","show-info"]))),128))])]),_:1}),m(o,{title:"我的客户",name:"my-customers"},{default:h(()=>[m(he,{"panel-title":"我的客户",tabs:n.value.tabs||[],"stats-text":n.value.statsText||"累计负责客户","total-customers":n.value.totalCustomers||0,"overview-cards":n.value.overviewCards||[],"customer-sections":n.value.customerSections||[],onCustomerClick:u},null,8,["tabs","stats-text","total-customers","overview-cards","customer-sections"])]),_:1})]),_:1},8,["active"])])}}}),Ce=K(Rs,[["__scopeId","data-v-7b13d55f"]]),Is={class:"flex items-center justify-between gap-2"},Ds={class:"flex flex-col justify-center min-w-0 flex-1"},Bs={class:"flex flex-col items-end flex-shrink-0 whitespace-nowrap"},Ls={class:"text-gray-600 font-sans font-medium",style:{"font-size":"18px","line-height":"1"}},Es={class:"text-gray-400 mt-0.5",style:{"font-size":"9px"}},As=z({name:"ProductCustomerCard"}),Us=Object.assign(As,{props:{customerName:{type:String,default:""},statusColor:{type:String,default:"gray"},count:{type:[Number,String],default:0},selected:{type:Boolean,default:!1},label:{type:String,default:"客户数"}},emits:["select"],setup(s,{emit:f}){const a=s,v=f,n=O(()=>a.customerName.includes("-")?a.customerName.split("-"):[a.customerName]),l=O(()=>a.statusColor==="gray"),u=O(()=>a.selected?"bg-blue-50 ring-2 ring-blue-500 ring-offset-1":l.value?"bg-gray-200":"bg-white"),r=()=>{v("select",{customerName:a.customerName})};return(i,o)=>(t(),c("div",{class:L(["rounded-lg shadow-sm border border-gray-100 cursor-pointer transition-all duration-200 py-2 px-3",u.value]),onClick:r},[e("div",Is,[e("div",Ds,[(t(!0),c(T,null,j(n.value,(p,d)=>(t(),c("span",{key:d,class:"text-xs font-medium text-gray-600 leading-tight truncate"},C(p),1))),128))]),e("div",Bs,[e("span",Ls,C(s.count),1),e("span",Es,C(s.label),1)])])],2))}}),Hs={class:"flex justify-between items-center"},Fs={class:"text-sm font-semibold text-gray-800 truncate mr-2"},Gs={class:"flex items-center gap-2 mt-1"},qs={class:"text-xs text-gray-400"},Ws={key:0,class:"text-xs text-gray-400 pl-3 border-l border-gray-200"},Xs=z({name:"InfoRowCard"}),Ys=Object.assign(Xs,{props:{title:{type:String,default:""},badgeText:{type:String,default:""},badgeColor:{type:String,default:"gray"},subText:{type:String,default:""},subDetail:{type:String,default:""}},emits:["click"],setup(s,{emit:f}){const a=s,v=f,n=O(()=>({red:"danger",green:"success",blue:"primary",orange:"warning",emerald:"success"})[a.badgeColor]||"default");return(l,u)=>{const r=ft,i=W;return t(),S(i,{title:s.title,"is-link":"",onClick:u[0]||(u[0]=o=>v("click"))},{title:h(()=>[e("div",Hs,[e("span",Fs,C(s.title),1),s.badgeText?(t(),S(r,{key:0,type:n.value,size:"small",round:""},{default:h(()=>[q(C(s.badgeText),1)]),_:1},8,["type"])):M("",!0)])]),label:h(()=>[e("div",Gs,[e("span",qs,C(s.subText),1),s.subDetail?(t(),c("span",Ws,C(s.subDetail),1)):M("",!0)])]),_:1},8,["title"])}}}),Q=s=>(Te("data-v-30f5a577"),s=s(),Ve(),s),Ks={class:"min-h-screen bg-[#f0f2f5] flex flex-col pb-14"},Zs={class:"px-4 pb-4"},Js={class:"bg-white/80 rounded-xl shadow-sm p-4"},Qs={class:"flex justify-between items-center mb-3"},ea=Q(()=>e("h2",{class:"text-base font-bold text-gray-600"},"我的产品",-1)),ta={class:"space-y-2 text-sm"},sa={class:"w-full flex justify-between items-center py-2 pl-3 pr-3"},aa=["onClick"],na={class:"font-medium text-gray-600"},la={class:"text-xs text-gray-400 ml-1"},oa=Q(()=>e("span",{class:"text-xs text-gray-400"},"只看运维",-1)),ca={class:"overflow-hidden"},ra={class:"bg-gray-100 rounded-xl p-3 mb-3 mx-1"},ia={class:"grid grid-cols-3 gap-3"},ua={class:"px-5 pb-4"},da={class:"flex gap-6 border-b border-gray-200"},ma={class:"px-5 pb-4 space-y-4"},fa=["onClick"],va={class:"text-sm font-bold text-gray-600"},_a={class:"flex items-center gap-3"},pa=["onClick"],ga={key:1,class:"text-xs text-gray-400"},ba={class:"overflow-hidden"},ha={class:"px-3 pb-3"},xa={key:0,class:"list-sub-header"},ya={class:"avatar"},ka=["onClick"],wa=Q(()=>e("img",{src:Oe,alt:"contact"},null,-1)),Ca=[wa],$a={key:0,class:"list-sub-header"},Sa=["onClick"],Na=Q(()=>e("img",{src:Oe,alt:"contact"},null,-1)),Ta=[Na],Va={class:"px-5 pb-12"},ja={class:"bg-white rounded-xl shadow-sm overflow-hidden"},Pa=Q(()=>e("div",{class:"px-4 py-3 border-b border-gray-50 flex justify-between items-center"},[e("h2",{class:"text-base font-bold text-gray-600"},"我的工单"),e("button",{class:"text-xs text-blue-600"},"查看全部")],-1)),Ma={class:"divide-y divide-gray-50"},Oa=z({name:"OpsStaff"}),za=Object.assign(Oa,{setup(s){Z();const f=b([]),a=b([]),v=b([]),n=b(!1),l=b({product:null,customer:null}),u=b({}),r=b("contacts"),i=b(!1),o=b(""),p=b(!1),d=b({}),k=b(!1),x=b([]),y=b(null),V=g=>{y.value=y.value===g?null:g},I=(g,$)=>{u.value[g]=$},U=(g,$)=>u.value[$]?g.statusColor!=="gray":!0,B=g=>{if(l.value.product===g.product&&l.value.customer===g.customer){G();return}l.value={product:g.product,customer:g.customer}},G=()=>{l.value={product:null,customer:null}},w=g=>l.value.product===g.product&&l.value.customer===g.customer,R=O(()=>l.value.product?a.value.filter(g=>{var H;const $=g.productName===l.value.product,E=!l.value.customer||l.value.customer.includes(g.customerName)||g.customerName.includes((H=l.value.customer)==null?void 0:H.split("-")[0]);return $&&E}):a.value),ee=O(()=>l.value.product?v.value.filter(g=>{const $=g.product===l.value.product,E=!l.value.customer||g.customer===l.value.customer;return $&&E}):v.value),te=b(""),Ie=g=>{te.value=te.value===g?"":g},De=g=>{d.value={name:g.name,role:g.title,avatar:"",department:"",email:"",phone:""},p.value=!0},ie=g=>{o.value=g,i.value=!0},Be=g=>{x.value=g||[],k.value=!0};return J(async()=>{n.value=!0;try{const[g,$,E]=await Promise.all([ot(),ct(),rt()]);if(f.value=g||[],a.value=($==null?void 0:$.groups)||[],v.value=E||[],f.value.length){const H=f.value.find(F=>F.expanded);y.value=(H==null?void 0:H.productName)||f.value[0].productName,f.value.forEach(F=>{u.value[F.productName]=!0})}}catch(g){console.warn("运维担当工作台数据加载失败",g)}finally{n.value=!1}}),(g,$)=>{const E=le,H=bt,F=W,se=mt,xe=Me,ye=ut,Le=dt;return t(),c("div",Ks,[m(re,null,{"header-extra":h(()=>[e("div",Zs,[e("div",Js,[e("div",Qs,[ea,l.value.product?(t(),c("button",{key:0,class:"flex items-center gap-1 text-blue-600 text-xs font-medium",onClick:G},[m(E,{name:"cross",class:"text-sm"}),q(" 清除筛选 ")])):M("",!0)]),e("div",ta,[(t(!0),c(T,null,j(f.value,_=>(t(),c("div",{key:_.productName,class:"rounded-lg border-b border-gray-50 bg-gray-50"},[e("div",sa,[e("button",{class:"flex items-center gap-2 bg-transparent border-none p-0 cursor-pointer",onClick:P=>V(_.productName)},[m(E,{name:"arrow",class:L(["transition-transform duration-300 text-lg",y.value===_.productName?"text-blue-600 rotate-90":"text-gray-400"])},null,8,["class"]),e("span",na,[q(C(_.productName)+" ",1),e("span",la,"("+C(_.customerCount)+")",1)])],8,aa),e("div",{class:"flex items-center gap-2",onClick:$[0]||($[0]=ae(()=>{},["stop"]))},[oa,m(H,{"model-value":u.value[_.productName],size:"20px","onUpdate:modelValue":P=>I(_.productName,P)},null,8,["model-value","onUpdate:modelValue"])])]),e("div",{class:"grid transition-[grid-template-rows] duration-300 ease-in-out",style:ve({gridTemplateRows:y.value===_.productName?"1fr":"0fr"})},[e("div",ca,[e("div",ra,[e("div",ia,[(t(!0),c(T,null,j(_.customers,P=>X((t(),S(Us,{key:P.customerName,"customer-name":P.customerName,"status-color":P.statusColor,count:P.count,selected:w(P),label:"工单数",onSelect:ue=>B(P)},null,8,["customer-name","status-color","count","selected","onSelect"])),[[Y,U(P,_.productName)]])),128))])])])],4)]))),128))])])])]),_:1}),e("div",ua,[e("div",da,[e("button",{class:L(["pb-2 text-sm transition-colors",r.value==="contacts"?"font-bold text-blue-600 border-b-2 border-blue-600":"font-medium text-gray-400"]),onClick:$[1]||($[1]=_=>r.value="contacts")},"联系人",2),e("button",{class:L(["pb-2 text-sm transition-colors",r.value==="orders"?"font-bold text-blue-600 border-b-2 border-blue-600":"font-medium text-gray-400"]),onClick:$[2]||($[2]=_=>r.value="orders")},"工单",2)])]),X(e("section",ma,[(t(!0),c(T,null,j(R.value,(_,P)=>{var ue;return t(),c("div",{key:`${_.customerName}-${_.productName}`,class:"rounded-xl overflow-hidden bg-white shadow-sm border border-gray-100"},[e("div",{class:"w-full bg-gray-50/50 py-2 px-3 flex justify-between items-center hover:bg-gray-50 transition-colors cursor-pointer",onClick:A=>Ie(P)},[e("span",va,C(_.customerName)+" · "+C(_.productName),1),e("div",_a,[(ue=_.relatedParties)!=null&&ue.length?(t(),c("a",{key:0,class:"text-xs text-blue-600 font-medium",onClick:ae(A=>Be(_.relatedParties),["stop"])}," 关联方 ("+C(_.relatedParties.reduce((A,N)=>{var D;return A+(((D=N.items)==null?void 0:D.length)||0)},0))+") ",9,pa)):(t(),c("span",ga,"关联方 (0)")),m(E,{name:"arrow",class:L(["transition-transform duration-300",te.value===P?"text-blue-600 rotate-90":"text-gray-400"])},null,8,["class"])])],8,fa),e("div",{class:"grid transition-[grid-template-rows] duration-300 ease-in-out",style:ve({gridTemplateRows:te.value===P?"1fr":"0fr"})},[e("div",ba,[e("div",ha,[m(Le,{"column-num":2,border:!1,gutter:0,class:"contact-grid mt-2"},{default:h(()=>[m(ye,null,{default:h(()=>[m(xe,{class:"contact-col"},{default:h(()=>{var A;return[m(F,{title:"客户方",class:"col-header"}),(t(!0),c(T,null,j(_.customerSide,N=>(t(),c(T,{key:N.name||N.title},[N.isHeader?(t(),c("div",xa,C(N.title),1)):(t(),S(F,{key:1,title:N.name,label:N.title,class:"contact-cell",onClick:D=>De(N)},{icon:h(()=>{var D;return[e("div",ya,C(N.avatar||((D=N.name)==null?void 0:D.slice(0,1))),1)]}),"right-icon":h(()=>[e("a",{class:"contact-trigger icon-only",onClick:ae(D=>ie(N.name),["stop"])},Ca,8,ka)]),_:2},1032,["title","label","onClick"]))],64))),128)),(A=_.customerSide)!=null&&A.length?M("",!0):(t(),S(se,{key:0,image:"search",description:"暂无联系人","image-size":40}))]}),_:2},1024)]),_:2},1024),m(ye,null,{default:h(()=>[m(xe,{class:"contact-col"},{default:h(()=>{var A;return[m(F,{title:"我方",class:"col-header"}),(t(!0),c(T,null,j(_.internalSide,N=>(t(),c(T,{key:N.name||N.title},[N.isHeader?(t(),c("div",$a,C(N.title),1)):(t(),S(F,{key:1,title:N.name,label:N.title,class:"contact-cell"},{icon:h(()=>{var D;return[e("div",{class:L(["avatar",N.bg==="green"?"green":""])},C(N.avatar||((D=N.name)==null?void 0:D.slice(0,1))),3)]}),"right-icon":h(()=>[e("a",{class:"contact-trigger icon-only",onClick:ae(D=>ie(N.name),["stop"])},Ta,8,Sa)]),_:2},1032,["title","label"]))],64))),128)),(A=_.internalSide)!=null&&A.length?M("",!0):(t(),S(se,{key:0,image:"search",description:"暂无联系人","image-size":40}))]}),_:2},1024)]),_:2},1024)]),_:2},1024)])])],4)])}),128)),R.value.length?M("",!0):(t(),S(se,{key:0,description:"没有匹配的联系人"}))],512),[[Y,r.value==="contacts"]]),X(e("section",Va,[e("div",ja,[Pa,e("div",Ma,[(t(!0),c(T,null,j(ee.value,(_,P)=>(t(),S(Ys,{key:P,title:_.title,"badge-text":_.badgeText,"badge-color":_.badgeColor,"sub-text":_.subText,"sub-detail":_.subDetail},null,8,["title","badge-text","badge-color","sub-text","sub-detail"]))),128)),ee.value.length?M("",!0):(t(),S(se,{key:0,description:"没有匹配的工单"}))])])],512),[[Y,r.value==="orders"]]),m(vt,{modelValue:i.value,"onUpdate:modelValue":$[3]||($[3]=_=>i.value=_),name:o.value},null,8,["modelValue","name"]),m(st,{modelValue:p.value,"onUpdate:modelValue":$[4]||($[4]=_=>p.value=_),person:d.value},null,8,["modelValue","person"]),m(at,{modelValue:k.value,"onUpdate:modelValue":$[5]||($[5]=_=>k.value=_),data:x.value,onContactClick:$[6]||($[6]=({name:_})=>ie(_))},null,8,["modelValue","data"])])}}}),Ra=K(za,[["__scopeId","data-v-30f5a577"]]),Ia=z({name:"Home"}),Qa=Object.assign(Ia,{setup(s){const f=et(),a=O(()=>{var n;return((n=f.userInfo)==null?void 0:n.role)||"business"}),v=O(()=>({manager:Ss,executive:Ps,business:Ce,"it-manager":Ra})[a.value]||Ce);return(n,l)=>(t(),S(tt(v.value)))}});export{Qa as default};
