import{_ as z,x as P,y as g,z as C,A as o,S as Z,ad as w,F as E,ae as N,N as M,f as m,G as S,ah as ee,U as te,V as ae,R as oe,K as se,r,at as ne,w as le,o as re,E as U,d as ce,k as ie,I as ue}from"./index-CDHd4m-7.js";import{E as de}from"./index-Bb7nynEf.js";import{F as me,L as pe,B as ve,D as ge,C as he}from"./index-DqpW3CVP.js";import{g as fe}from"./product-DTCdCccy.js";import{_ as _e,a as ye,b as ke}from"./index-Ds3NWbdX.js";import{T as be}from"./index-D3_krIJX.js";import{_ as we}from"./paperPlane-wi0kQdUE.js";/* empty css              */import{_ as Ce}from"./index-1VR3Jiot.js";import{S as $e}from"./index-B2_E0uL9.js";import"./use-id-D2bIr3ea.js";import"./index-BUY7RLdX.js";import"./index-CViZOMyQ.js";import"./index-D-jpgpWR.js";import"./index-Biv-2Zfy.js";const R=s=>(te("data-v-50a2b111"),s=s(),ae(),s),xe={class:"product-card"},Ve={class:"card-header"},Se={class:"product-content"},Le=["innerHTML"],Te={class:"product-meta"},Pe={class:"tag-category"},Be={class:"tag-department"},Fe={key:0,class:"product-tags-row"},Me=["innerHTML"],Re={key:0,class:"product-tag more"},De=R(()=>o("div",{class:"card-divider"},null,-1)),Ie={class:"manager-row"},Ue={class:"manager-avatar"},ze={class:"manager-info"},Ee={class:"manager-name"},Ne={class:"manager-org"},qe={class:"contact-actions"},Oe=R(()=>o("img",{src:we,alt:"contact",class:"contact-icon"},null,-1)),je=R(()=>o("span",null,"联系",-1)),Ae={__name:"index",props:{product:{type:Object,required:!0},keyword:{type:String,default:""}},emits:["monitor"],setup(s){const u=s,L=P(()=>{const c=(u.product.name||"").replace(" - "," ｜ "),n=(u.keyword||"").trim();if(!n)return c;const i=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),d=new RegExp(`(${i})`,"gi");return c.replace(d,'<span class="hl">$1</span>')}),l=c=>{const n=(u.keyword||"").trim();if(!n)return c;const i=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),d=new RegExp(`(${i})`,"gi");return c.replace(d,'<span class="hl">$1</span>')},y=P(()=>(u.product.products||[]).slice(0,3)),T=P(()=>{const n=(u.product.products||[]).length-3,i=u.product.moreCount||0;return n>0?n+i:i});return(c,n)=>{var d,$,h,p,k,b;const i=be;return g(),C("div",xe,[o("div",Ve,[o("div",{class:Z(["product-icon",s.product.iconClass||"c1"])},w(s.product.icon||((d=s.product.name)==null?void 0:d.slice(0,3))),3),o("div",Se,[o("div",{class:"product-name",innerHTML:L.value},null,8,Le),o("div",Te,[o("span",Pe,w(s.product.category),1),o("span",Be,"负责部门："+w(s.product.department),1)])])]),y.value.length?(g(),C("div",Fe,[(g(!0),C(E,null,N(y.value,(x,f)=>(g(),C("span",{key:f,class:"product-tag",innerHTML:l(x)},null,8,Me))),128)),T.value>0?(g(),C("span",Re," +"+w(T.value),1)):M("",!0)])):M("",!0),De,o("div",Ie,[o("div",Ue,w((($=s.product.manager)==null?void 0:$.avatar)||(((h=s.product.manager)==null?void 0:h.name)||"").charAt(0)),1),o("div",ze,[o("div",Ee,w((p=s.product.manager)==null?void 0:p.name),1),o("div",Ne,w(((k=s.product.manager)==null?void 0:k.org)||((b=s.product.manager)==null?void 0:b.department)),1)]),o("div",qe,[m(i,{class:"contact-btn",onClick:n[0]||(n[0]=ee(x=>{var f;return c.$emit("monitor",(f=s.product.manager)==null?void 0:f.name)},["stop"]))},{default:S(()=>[Oe,je]),_:1})])])])}}},He=z(Ae,[["__scopeId","data-v-50a2b111"]]),Ge={class:"product-list-page"},Ke={class:"bg-white sticky top-0 z-50"},Je={class:"flex items-center px-4 py-2 border-b border-gray-100"},Qe={class:"px-3 pt-2"},We=ce({name:"ProductList"}),Xe=Object.assign(We,{setup(s){const u=oe(),L=se(),l=r(L.query.keyword||""),y=r("product");ne(()=>{y.value="product";const e=L.query.keyword||"";e&&e!==l.value&&(l.value=e,_())});const T=[{label:"搜客户",value:"customer"},{label:"搜产品",value:"product"}],c=r([]),n=r([]),i=r([]),d=r([]),$=r("external"),h=r([]),p=r(!1),k=r(!1),b=r(1),x=10,f=r(!1),D=r(""),q=e=>{console.log("更多筛选:",e),_()},O=e=>{$.value=e,_()},j=P(()=>[{key:"business",label:"领域",icon:""},{key:"department",label:"部门",icon:""},{key:"more",label:"更多",icon:""}]),A=e=>{e==="customer"&&(ie(()=>{y.value="product"}),u.replace({name:"CustomerList",query:{keyword:l.value}}))},H=e=>{l.value=e||l.value,_()};let B=null;le(l,()=>{clearTimeout(B),B=setTimeout(()=>{_()},100)});const G=()=>{u.back()},K=()=>{l.value="",clearTimeout(B),_()},_=()=>{b.value=1,h.value=[],k.value=!1,F()},F=async()=>{if(!p.value){p.value=!0;try{const e={keyword:l.value,business:i.value.join(","),department:d.value.join(","),scope:$.value,page:b.value,pageSize:x},t=await fe(e),V=(t==null?void 0:t.list)||t||[];b.value===1?h.value=V:h.value.push(...V),V.length<x&&(k.value=!0),b.value++}catch(e){console.error("加载产品列表失败:",e),k.value=!0}finally{p.value=!1}}},J=async()=>{try{const[e,t]=await Promise.allSettled([ye(),ke()]);e.status==="fulfilled"&&(c.value=e.value||[]),t.status==="fulfilled"&&(n.value=t.value||[])}catch(e){console.error("加载筛选选项失败:",e)}},Q=e=>{u.push({name:"ProductDetail",query:{id:e.id,name:e.name}})},W=e=>{D.value=e,f.value=!0};return re(()=>{J(),F()}),(e,t)=>{const V=ue,X=pe,Y=de;return g(),C("div",Ge,[o("div",Ke,[o("div",Je,[m(V,{name:"arrow-left",size:"24",onClick:G,class:"mr-3 cursor-pointer"}),m(_e,{modelValue:y.value,"onUpdate:modelValue":[t[0]||(t[0]=a=>y.value=a),A],tabs:T,class:"flex-1"},null,8,["modelValue"])]),m($e,{modelValue:l.value,"onUpdate:modelValue":t[1]||(t[1]=a=>l.value=a),placeholder:"搜索产品",onSearch:H,onClear:K,"show-back":!1},null,8,["modelValue"]),m(me,{"main-filters":j.value,"group-value":$.value,onGroupChange:O},{business:S(({close:a})=>[m(ve,{options:c.value,modelValue:i.value,"onUpdate:modelValue":t[2]||(t[2]=v=>i.value=v),onSelectionChange:v=>{_(),a()}},null,8,["options","modelValue","onSelectionChange"])]),department:S(({close:a})=>[m(ge,{departments:n.value,modelValue:d.value,"onUpdate:modelValue":t[3]||(t[3]=v=>d.value=v),onSelectionChange:v=>{_(),a()}},null,8,["departments","modelValue","onSelectionChange"])]),more:S(({close:a})=>[m(he,{onConfirm:v=>{q(v),a()},onReset:a},null,8,["onConfirm","onReset"])]),_:1},8,["main-filters","group-value"])]),o("div",Qe,[m(X,{loading:p.value,"onUpdate:loading":t[4]||(t[4]=a=>p.value=a),finished:k.value,"finished-text":"已加载全部",onLoad:F},{default:S(()=>[(g(!0),C(E,null,N(h.value,a=>(g(),U(He,{key:a.id,product:a,keyword:l.value,onClick:v=>Q(a),onMonitor:v=>{var I;return W((I=a.manager)==null?void 0:I.name)},class:"mb-2"},null,8,["product","keyword","onClick","onMonitor"]))),128))]),_:1},8,["loading","finished"]),!p.value&&!h.value.length?(g(),U(Y,{key:0,description:"暂无产品数据"})):M("",!0)]),m(Ce,{modelValue:f.value,"onUpdate:modelValue":t[5]||(t[5]=a=>f.value=a),name:D.value},null,8,["modelValue","name"])])}}}),pt=z(Xe,[["__scopeId","data-v-45fc93ba"]]);export{pt as default};
