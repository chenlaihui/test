import{_ as D,x as C,y as c,z as v,A as l,S as F,ad as V,N as S,f as h,ah as q,F as A,ae as B,G as L,I as G,U as re,V as ie,r as u,d as K,R as ce,K as ue,at as de,w as me,o as pe,E as H,k as ve}from"./index-C_WQiL5x.js";import{E as ye}from"./index-DhnzfwLA.js";import{F as fe,L as he,B as ge,D as _e,C as ke}from"./index-Dnx2LsfU.js";import{g as Ce}from"./customer-Cl2wR_Zs.js";import{_ as be,c as we,b as $e,d as xe}from"./index-BunFvg-i.js";import{T as Ve}from"./index-htBXaGZI.js";import{_ as Se}from"./paperPlane-CWtWibU4.js";/* empty css              */import{_ as Te}from"./index-DFfJ5MZ9.js";import{S as Ie}from"./index-CP9mRTef.js";import"./use-id-CROUrReO.js";import"./index-BEOc3wvK.js";import"./index-CFH9amCW.js";import"./index-DV9eZzCp.js";import"./index-X5SftILh.js";const E=d=>(re("data-v-9ec23948"),d=d(),ie(),d),Le={class:"flex items-start gap-3"},Ne={class:"flex-1 min-w-0"},Fe=["innerHTML"],Ae={class:"flex items-center gap-1.5 mt-1.5 flex-wrap"},Be={key:0,class:"tag-chip entity"},Re={key:1,class:"tag-chip industry"},Me={key:0,class:"flex items-center gap-1.5 mt-2.5 flex-wrap"},Pe=["innerHTML"],De={key:0,class:"product-tag more"},Ee=E(()=>l("div",{class:"card-divider"},null,-1)),Ue={key:1,class:"flex items-center gap-3"},Oe={class:"manager-avatar"},je={class:"flex-1 min-w-0"},qe={class:"text-sm font-semibold text-gray-900"},He={class:"text-xs text-gray-400"},ze=E(()=>l("img",{src:Se,alt:"contact",class:"contact-icon"},null,-1)),Ge=E(()=>l("span",null,"联系",-1)),z=3,Ke={__name:"index",props:{company:{type:Object,required:!0},keyword:{type:String,default:""}},emits:["click","call","arrow-click"],setup(d){const o=d,g=C(()=>o.company.iconText||o.company.logo||(o.company.shortName||"").slice(0,2)||"?"),r=C(()=>{const m=o.company.name||o.company.fullName||o.company.shortName||"",a=(o.keyword||"").trim();if(!a)return m;const y=a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),s=new RegExp(`(${y})`,"gi");return m.replace(s,'<span class="hl">$1</span>')}),k=C(()=>o.company.products||[]),T=C(()=>{const m=k.value.slice(0,z),a=(o.keyword||"").trim();if(!a)return m;const y=a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),s=new RegExp(`(${y})`,"gi");return m.map(p=>p.replace(s,'<span class="hl">$1</span>'))}),b=C(()=>{const a=k.value.length-z,y=o.company.moreCount||0;return a>0?a+y:y}),w=C(()=>o.company.industrySub||o.company.industry||"");return(m,a)=>{const y=G,s=Ve;return c(),v("div",{class:"company-card",onClick:a[2]||(a[2]=p=>m.$emit("click"))},[l("div",Le,[l("div",{class:F(["card-icon",{"icon-small":g.value.length>3}])},V(g.value),3),l("div",Ne,[l("div",{class:"company-name",innerHTML:r.value},null,8,Fe),l("div",Ae,[d.company.entity?(c(),v("span",Be,V(d.company.entity),1)):S("",!0),w.value?(c(),v("span",Re,V(w.value),1)):S("",!0)])]),h(y,{name:"arrow",class:"text-gray-300 mt-1 flex-shrink-0 cursor-pointer",onClick:a[0]||(a[0]=q(p=>m.$emit("arrow-click"),["stop"]))})]),k.value.length?(c(),v("div",Me,[(c(!0),v(A,null,B(T.value,(p,i)=>(c(),v("span",{key:i,class:"product-tag",innerHTML:p},null,8,Pe))),128)),b.value>0?(c(),v("span",De,"+"+V(b.value),1)):S("",!0)])):S("",!0),Ee,d.company.manager?(c(),v("div",Ue,[l("div",Oe,V(d.company.manager.avatar||(d.company.manager.name||"").charAt(0)),1),l("div",je,[l("div",qe,V(d.company.manager.name),1),l("div",He,V(d.company.manager.org||""),1)]),h(s,{class:"contact-btn",onClick:a[1]||(a[1]=q(p=>m.$emit("call",d.company.manager.phone),["stop"]))},{default:L(()=>[ze,Ge]),_:1})])):S("",!0)])}}},Je=D(Ke,[["__scopeId","data-v-9ec23948"]]),Qe={class:"ip-container"},We={class:"ip-tabs"},Xe=["onClick"],Ye=["innerHTML"],Ze={class:"ip-content"},et=["onClick"],tt={key:0,class:"ip-check"},at=K({name:"IndustryFilterPanel"}),nt=Object.assign(at,{props:{industries:{type:Array,default:()=>[]},modelValue:{type:Array,default:()=>[]}},emits:["update:modelValue","selection-change"],setup(d,{emit:o}){const g=d,r=o,k=[{label:`交通运输
器械`,items:["摩托车制造","电动自行车制造"]},{label:"设备",items:["工业机器人","金属机械加工设备","工程机械设备","仪器仪表","医疗器械制造","专用设备","其它设备"]},{label:"零部件",items:["汽摩配","机加零部件","电气电子零部件","橡塑零部件","电子元器件","半导体关联","其它零部件"]},{label:`住设及
生活用品`,items:["乐器","家居卫浴","住宅零部件","体育用品制造","其它用品"]},{label:"材料加工",items:["金属材料加工","石油","润滑油","其它材料加工"]},{label:"食品医药",items:["食品加工","饮料生产","药品制造"]},{label:"服务等",items:["商品贸易","运输仓储服务","检验检测服务","软件与信息技术服务","咨询服务","教育服务","政府及事业单位","其他专业服务业"]}],T=C(()=>{var s;return g.industries.length&&((s=g.industries[0])!=null&&s.children)&&!/^[一二三四五六七八九十]+、/.test(g.industries[0].label)?g.industries.map(p=>({label:p.label,items:(p.children||[]).map(i=>i.label||i.value)})):k}),b=u(0),w=u(g.modelValue[0]||""),m=C(()=>{var s;return((s=T.value[b.value])==null?void 0:s.items)||[]}),a=C(()=>m.value.length>6),y=s=>{w.value=s,r("update:modelValue",[s]),r("selection-change",{selected:[s]})};return(s,p)=>(c(),v("div",Qe,[l("div",We,[(c(!0),v(A,null,B(T.value,(i,_)=>(c(),v("div",{key:_,class:F(["ip-tab",{active:b.value===_}]),onClick:I=>b.value=_},[l("span",{innerHTML:i.label.replace("\\n","<br>")},null,8,Ye)],10,Xe))),128))]),l("div",Ze,[l("div",{class:F(a.value?"ip-grid":"ip-list")},[(c(!0),v(A,null,B(m.value,i=>(c(),v("div",{key:i,class:F(["ip-item",{selected:w.value===i}]),onClick:_=>y(i)},[l("span",null,V(i),1),w.value===i?(c(),v("span",tt,"✓")):S("",!0)],10,et))),128))],2)])]))}}),st=D(nt,[["__scopeId","data-v-be5b88c0"]]),lt={class:"customer-list-page"},ot={class:"bg-white sticky top-0 z-50"},rt={class:"flex items-center px-4 py-2 border-b border-gray-100"},it={class:"px-3 pt-2"},ct=K({name:"CustomerList"}),ut=Object.assign(ct,{setup(d){const o=ce(),g=ue(),r=u(g.query.keyword||""),k=u("customer");de(()=>{k.value="customer";const e=g.query.keyword||"";e&&e!==r.value&&(r.value=e,$())});const T=[{label:"搜客户",value:"customer"},{label:"搜产品",value:"product"}],b=u([]),w=u([]),m=u([]),a=u([]),y=u([]),s=u([]),p=u("external"),i=u([]),_=u(!1),I=u(!1),N=u(1),U=10,R=u(!1),O=u(""),J=C(()=>[{key:"entity",label:"营业主体"},{key:"department",label:"交付部门"},{key:"industry",label:"行业"},{key:"more",label:"更多"}]),Q=e=>{e==="product"&&(ve(()=>{k.value="customer"}),o.replace({name:"ProductList",query:{keyword:r.value}}))},W=e=>{r.value=e||r.value,$()};let M=null;me(r,()=>{clearTimeout(M),M=setTimeout(()=>{$()},100)});const X=()=>{o.back()},Y=()=>{r.value="",clearTimeout(M),$()},Z=e=>{p.value=e,$()},ee=e=>{console.log("更多筛选:",e),$()},$=()=>{N.value=1,i.value=[],I.value=!1,P()},P=async()=>{if(!_.value){_.value=!0;try{const e={scope:p.value,keyword:r.value,entity:a.value.join(","),industry:s.value.join(","),department:y.value.join(","),page:N.value,pageSize:U},t=await Ce(e),x=(t==null?void 0:t.list)||t||[];Array.isArray(x)?(N.value===1?i.value=x:i.value.push(...x),x.length<U&&(I.value=!0)):I.value=!0,N.value++}catch(e){console.error("加载客户列表失败:",e),I.value=!0}finally{_.value=!1}}},te=async()=>{try{const[e,t,x]=await Promise.allSettled([we(),$e(),xe()]);e.status==="fulfilled"&&(b.value=e.value||[]),t.status==="fulfilled"&&(w.value=t.value||[]),x.status==="fulfilled"&&(m.value=x.value||[])}catch(e){console.error("加载筛选选项失败:",e)}},ae=e=>{o.push({name:"CustomerDetail",query:{name:e.shortName||e.fullName,keyword:r.value||"",scope:p.value}})},ne=e=>{o.push({name:"CustomerProfile",query:{name:e.shortName||e.fullName,keyword:r.value||"",scope:p.value}})},se=e=>{O.value=e,R.value=!0};return pe(()=>{te(),P()}),(e,t)=>{const x=G,le=he,oe=ye;return c(),v("div",lt,[l("div",ot,[l("div",rt,[h(x,{name:"arrow-left",size:"24",onClick:X,class:"mr-3 cursor-pointer"}),h(be,{modelValue:k.value,"onUpdate:modelValue":[t[0]||(t[0]=n=>k.value=n),Q],tabs:T,class:"flex-1"},null,8,["modelValue"])]),h(Ie,{modelValue:r.value,"onUpdate:modelValue":t[1]||(t[1]=n=>r.value=n),placeholder:"搜索客户",onSearch:W,onClear:Y,"show-back":!1},null,8,["modelValue"]),h(fe,{"main-filters":J.value,"group-value":p.value,onGroupChange:Z},{entity:L(({close:n})=>[h(ge,{options:b.value,modelValue:a.value,"onUpdate:modelValue":t[2]||(t[2]=f=>a.value=f),onSelectionChange:f=>{$(),n()}},null,8,["options","modelValue","onSelectionChange"])]),department:L(({close:n})=>[h(_e,{departments:w.value,modelValue:y.value,"onUpdate:modelValue":t[3]||(t[3]=f=>y.value=f),mode:"internal",onSelectionChange:f=>{$(),n()}},null,8,["departments","modelValue","onSelectionChange"])]),industry:L(({close:n})=>[h(st,{industries:m.value,modelValue:s.value,"onUpdate:modelValue":t[4]||(t[4]=f=>s.value=f),onSelectionChange:f=>{$(),n()}},null,8,["industries","modelValue","onSelectionChange"])]),more:L(({close:n})=>[h(ke,{onConfirm:f=>{ee(f),n()},onReset:n},null,8,["onConfirm","onReset"])]),_:1},8,["main-filters","group-value"])]),l("div",it,[h(le,{loading:_.value,"onUpdate:loading":t[5]||(t[5]=n=>_.value=n),finished:I.value,"finished-text":"已加载全部",onLoad:P},{default:L(()=>[(c(!0),v(A,null,B(i.value,(n,f)=>(c(),H(Je,{key:f,company:n,keyword:r.value,onClick:j=>ae(n),onArrowClick:j=>ne(n),onCall:j=>se(n.shortName),class:"mb-2"},null,8,["company","keyword","onClick","onArrowClick","onCall"]))),128))]),_:1},8,["loading","finished"]),!_.value&&!i.value.length?(c(),H(oe,{key:0,description:"暂无客户数据"})):S("",!0)]),h(Te,{modelValue:R.value,"onUpdate:modelValue":t[6]||(t[6]=n=>R.value=n),name:O.value},null,8,["modelValue","name"])])}}}),Vt=D(ut,[["__scopeId","data-v-286458f0"]]);export{Vt as default};
