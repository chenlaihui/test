import{_ as re,K as de,R as ue,x as b,r as v,o as me,w as _e,y as c,z as m,f as i,G as l,H as ve,A as s,F as V,ae as A,E as k,N as h,d as pe,ad as r,S as Y,a2 as W,af as fe,ah as Q,U as he,V as ge,I as ye}from"./index-CDHd4m-7.js";import{G as be,a as ke}from"./index-BrYkbpSe.js";import{E as Ce}from"./index-Bb7nynEf.js";import{T as we}from"./index-D3_krIJX.js";/* empty css              */import{C as Se}from"./index-BUY7RLdX.js";import{C as Ne}from"./index-CViZOMyQ.js";import{N as Ve}from"./index-BgsyOcko.js";import{_ as X}from"./paperPlane-wi0kQdUE.js";import{a as xe}from"./customer-DeTKlcpa.js";import{P as Te}from"./index-C4YtUO6x.js";import{_ as $e}from"./index-1VR3Jiot.js";import{b as Ie,_ as Be}from"./index-BEVg9lj_.js";import{B as Pe}from"./index-CKBujJ5N.js";import"./use-id-D2bIr3ea.js";import"./use-placeholder-BMzKlav9.js";import"./index-DBGdIKog.js";const x=T=>(he("data-v-bca2c3a0"),T=T(),ge(),T),De={class:"customer-detail-page"},Ee={class:"search-pill"},ze={class:"main-scroll",id:"mainScrollView"},Re={class:"main-card"},Ge={class:"company-info"},Oe={class:"company-name"},qe={class:"company-tags"},He={key:0,class:"tag tag-grey"},Ue={key:1,class:"tag tag-highlight"},Me={key:0,class:"company-address"},Ae=x(()=>s("div",{class:"divider"},null,-1)),Ke={class:"info-inline"},je=x(()=>s("span",{class:"info-label"},"营业主体:",-1)),Fe={class:"info-val"},Je=x(()=>s("span",{class:"info-label"},"客户经理:",-1)),Le={class:"info-val"},Ye={class:"tabs-wrap",id:"stickyTabsContainer"},We={class:"products-container"},Qe=["id"],Xe={class:"section-title"},Ze={class:"product-title"},ea=["onClick"],aa={key:0,class:"list-sub-header"},ta=["onClick"],oa=x(()=>s("img",{src:X,alt:"contact"},null,-1)),sa=[oa],la={key:0,class:"list-sub-header"},na=["onClick"],ia=x(()=>s("img",{src:X,alt:"contact"},null,-1)),ca=[ia],ra=pe({name:"CustomerDetail"}),da=Object.assign(ra,{setup(T){const g=de(),Z=ue(),ee=b(()=>g.query.keyword||g.query.name||""),$=v({}),I=v([]),B=v({}),P=v(""),S=v(!1),R=v(!1),D=v({name:"",phone:"",email:""}),G=v(!1),K=v({}),O=v(!1),q=v([]),d=b(()=>$.value),H=b(()=>{var e,a,o;return((a=(e=d.value)==null?void 0:e.manager)==null?void 0:a.name)||((o=d.value)==null?void 0:o.managerName)||""}),j=b(()=>{const e=d.value||{};return e.iconText||e.logo||(e.shortName||e.name||"").slice(0,2)||"?"}),ae=b(()=>{const e=I.value.map(a=>({group:a.domain||a.group,items:(a.items||[]).map(o=>({id:o.id||o.code,code:o.code,name:o.name,label:o.code}))}));return console.log("tabData computed:",e),e}),U=b(()=>{const e=I.value.flatMap(a=>a.items||[]);return console.log("allProducts computed:",e),e}),F="browseHistory",te=e=>{if(!(!e||!e.shortName&&!e.fullName))try{const a=localStorage.getItem(F);let o=a?JSON.parse(a):[];const _=e.shortName||e.fullName;o=o.filter(y=>(y.shortName||y.name)!==_);const u=new Date,p=`${String(u.getMonth()+1).padStart(2,"0")}-${String(u.getDate()).padStart(2,"0")}`;o.unshift({shortName:e.shortName||"",name:e.shortName||e.fullName||"",fullName:e.fullName||e.shortName||"",date:p}),o=o.slice(0,20),localStorage.setItem(F,JSON.stringify(o))}catch{}},J=async()=>{try{const e=g.query.name||g.params.name,a=g.query.scope||"external";if(!e){console.error("缺少客户名称参数");return}const o=await xe({name:e,scope:a});if(console.log("客户详情API返回:",o),console.log("detailRes keys:",Object.keys(o||{})),o){$.value=o.company||{},I.value=o.productGroups||[],B.value=o.productContacts||{},console.log("公司信息:",$.value),console.log("产品分组:",I.value),console.log("产品联系人:",B.value),te($.value);const _=U.value[0];_&&(P.value=_.id||_.code)}}catch(e){console.error("加载客户详情失败:",e)}},oe=e=>{const a=(e==null?void 0:e.id)||e;P.value=a;const o=S.value;S.value&&(S.value=!1),setTimeout(()=>{const _=document.getElementById(`product-section-${a}`),u=document.getElementById("mainScrollView"),p=document.querySelector(".tabs-wrap");if(!_||!u){console.warn("未找到滚动目标或容器",{el:_,mainScroll:u,id:a});return}const y=p?p.offsetHeight:0,z=_.offsetTop,C=z-y-50;console.log("滚动到产品：",{id:a,elementOffsetTop:z,tabsHeight:y,targetScroll:C}),u.scrollTo({top:Math.max(0,C),behavior:"smooth"})},o?150:50)},se=b(()=>{const e=U.value;return console.log("visibleProducts computed:",e),e}),N=e=>{D.value={name:e.name||"",phone:e.phone||"",email:e.email||""},R.value=!0},le=e=>{K.value=e,G.value=!0},ne=({person:e})=>{N(e)},ie=e=>{const a=B.value[e.id||e.code];a!=null&&a.related?q.value=a.related:q.value=[{title:e.name||e.code,items:[...(a==null?void 0:a.client)||[],...(a==null?void 0:a.internal)||[]]}],O.value=!0},E=e=>B.value[e]||{client:[],internal:[]};return me(()=>{J()}),_e(()=>g.query.name||g.params.name,(e,a)=>{e&&e!==a&&(console.log("路由变化，重新加载:",a,"->",e),J())}),(e,a)=>{const o=ye,_=Ve,u=Ne,p=Se,y=Pe,z=we,C=Ce,L=be,ce=ke;return c(),m("div",De,[i(_,{"left-arrow":"",fixed:"",placeholder:"",onClickLeft:a[0]||(a[0]=t=>ve(Z).back())},{title:l(()=>[s("div",Ee,[i(o,{name:"search",size:"14",class:"pill-icon"}),s("span",null,"搜索: "+r(ee.value),1)])]),_:1}),s("div",ze,[s("div",Re,[i(p,{class:"company-card"},{default:l(()=>[i(u,null,{icon:l(()=>[s("div",{class:Y(["company-logo",{"logo-small":j.value.length>3}])},r(j.value),3)]),title:l(()=>[s("div",Ge,[s("div",Oe,r(d.value.fullName||d.value.name||d.value.shortName),1),s("div",qe,[d.value.since?(c(),m("span",He," Since "+r(d.value.since),1)):h("",!0),d.value.industry?(c(),m("span",Ue,r(d.value.industry),1)):h("",!0)])])]),_:1}),d.value.address?(c(),m("div",Me,[i(o,{name:"location-o",class:"address-icon"}),s("span",null,r(d.value.address),1)])):h("",!0)]),_:1}),Ae,i(p,{class:"info-card"},{default:l(()=>[i(u,{class:"info-row"},{title:l(()=>[s("div",Ke,[je,s("span",Fe,r(d.value.entity||"-"),1),Je,s("span",Le,r(H.value||"-"),1)])]),"right-icon":l(()=>[H.value?(c(),k(y,{key:0,size:"small",type:"primary",plain:"",round:"",onClick:a[1]||(a[1]=t=>N(d.value.manager||{name:H.value}))},{default:l(()=>[W(" 联系 ")]),_:1})):h("",!0)]),_:1})]),_:1}),s("div",Ye,[i(Te,{modelValue:P.value,"onUpdate:modelValue":a[2]||(a[2]=t=>P.value=t),data:ae.value,expanded:S.value,"list-title":"全部产品","onUpdate:expanded":a[3]||(a[3]=t=>S.value=t),onTabChange:oe},null,8,["modelValue","data","expanded"])]),s("div",We,[(c(!0),m(V,null,A(se.value,t=>(c(),m("div",{key:t.id||t.code,id:`product-section-${t.id||t.code}`,class:"product-section"},[i(p,null,{default:l(()=>[i(u,{class:"product-header"},{title:l(()=>[s("div",Xe,[s("div",Ze,r(t.code)+" "+r(t.name),1),t.domain?(c(),k(z,{key:0,type:"primary",plain:"",size:"small",class:"product-domain"},{default:l(()=>[W(r(t.domain),1)]),_:2},1024)):h("",!0)])]),"right-icon":l(()=>[s("span",{class:"section-link",onClick:w=>ie(t)},"关联方 →",8,ea)]),_:2},1024),i(ce,{"column-num":2,border:!1,gutter:0,class:"contact-grid"},{default:l(()=>[i(L,null,{default:l(()=>[i(p,{class:"contact-col"},{default:l(()=>{var w;return[i(u,{title:"客户方",class:"col-header"}),(c(!0),m(V,null,A(E(t.id||t.code).client,(n,M)=>(c(),m(V,{key:`client-${M}`},[n.type==="group"?(c(),m("div",aa,r(n.label),1)):(c(),k(u,{key:1,title:n.name,label:n.title||n.role,class:"contact-cell",onClick:f=>le(n)},{icon:l(()=>{var f;return[s("div",{class:"avatar",style:fe(n.style||"")},r(n.initial||((f=n.name)==null?void 0:f.charAt(0))||""),5)]}),"right-icon":l(()=>[s("a",{class:"contact-trigger icon-only",onClick:Q(f=>N(n),["stop"])},sa,8,ta)]),_:2},1032,["title","label","onClick"]))],64))),128)),(w=E(t.id||t.code).client)!=null&&w.length?h("",!0):(c(),k(C,{key:0,image:"search",description:"暂无联系人","image-size":40}))]}),_:2},1024)]),_:2},1024),i(L,null,{default:l(()=>[i(p,{class:"contact-col"},{default:l(()=>{var w;return[i(u,{title:"我方",class:"col-header"}),(c(!0),m(V,null,A(E(t.id||t.code).internal,(n,M)=>(c(),m(V,{key:`internal-${M}`},[n.type==="group"?(c(),m("div",la,r(n.label),1)):(c(),k(u,{key:1,title:n.name,label:n.title||n.role,class:"contact-cell"},{icon:l(()=>{var f;return[s("div",{class:Y(["avatar",n.theme||""])},r(n.initial||((f=n.name)==null?void 0:f.charAt(0))||""),3)]}),"right-icon":l(()=>[s("a",{class:"contact-trigger icon-only",onClick:Q(f=>N(n),["stop"])},ca,8,na)]),_:2},1032,["title","label"]))],64))),128)),(w=E(t.id||t.code).internal)!=null&&w.length?h("",!0):(c(),k(C,{key:0,image:"search",description:"暂无联系人","image-size":40}))]}),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)],8,Qe))),128)),U.value.length?h("",!0):(c(),k(C,{key:0,description:"暂无产品数据"}))])])]),i($e,{modelValue:R.value,"onUpdate:modelValue":a[4]||(a[4]=t=>R.value=t),name:D.value.name,phone:D.value.phone,email:D.value.email},null,8,["modelValue","name","phone","email"]),i(Ie,{modelValue:O.value,"onUpdate:modelValue":a[5]||(a[5]=t=>O.value=t),data:q.value,onContactClick:a[6]||(a[6]=({person:t})=>N(t))},null,8,["modelValue","data"]),i(Be,{modelValue:G.value,"onUpdate:modelValue":a[7]||(a[7]=t=>G.value=t),person:K.value,onContact:ne},null,8,["modelValue","person"])])}}}),Ta=re(da,[["__scopeId","data-v-bca2c3a0"]]);export{Ta as default};
